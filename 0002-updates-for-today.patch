From a1930574f86763c6b49b5000bbc77a833c91592f Mon Sep 17 00:00:00 2001
From: Dennis <dyurkevich@radiumone.com>
Date: Wed, 2 Dec 2015 13:02:50 +0000
Subject: [PATCH 2/3] updates for today

---
 app/controllers/clickHandler.server.js | 20 ++++++++++++++++++++
 app/routes/index.js                    | 11 +++++++++--
 2 files changed, 29 insertions(+), 2 deletions(-)
 create mode 100644 app/controllers/clickHandler.server.js

diff --git a/app/controllers/clickHandler.server.js b/app/controllers/clickHandler.server.js
new file mode 100644
index 0000000..d7b513d
--- /dev/null
+++ b/app/controllers/clickHandler.server.js
@@ -0,0 +1,20 @@
+"use strict";
+
+function clickHandler (db) {
+    
+    var imps = db.collection("imps");
+    
+    // method to return the number of records in the collection "imps"
+    this.getCount = function (req, res){
+        imps.count({}, function(err, result){
+            if (err) {
+                throw err;
+            }
+            res.json(result);
+        });
+    };
+
+    
+}
+
+module.exports = clickHandler;
diff --git a/app/routes/index.js b/app/routes/index.js
index 2642089..c809d30 100644
--- a/app/routes/index.js
+++ b/app/routes/index.js
@@ -1,10 +1,14 @@
 "use strict";
 
+var ClickHandler = require(process.cwd() + '/app/controllers/clickHandler.server.js');
+
 module.exports = function (app, db) {
     
     var qs = require("querystring");
     var _ = require("underscore");
     
+    var clickHandler = new ClickHandler(db);
+    
     app.route("/")
         .get(function(req, res){
             res.sendFile(process.cwd() + "/public/index.html");
@@ -26,7 +30,7 @@ module.exports = function (app, db) {
             var dataToInsert = {};
             _.extend(dataToInsert, req.body, str);
             
-            db.collection("seconds").insert(dataToInsert, function (err){
+            db.collection("imps").insert(dataToInsert, function (err){
                 if (err) { throw err }
             });
             console.log(dataToInsert);
@@ -35,9 +39,12 @@ module.exports = function (app, db) {
         
         .get(function(req, res){
             console.log("getting data");
-            db.collection("seconds").find({}).toArray(function(err, result){
+            db.collection("imps").find({}).toArray(function(err, result){
                 if (err) throw err;
                 res.send(result);
             });
         });
+        
+    app.route("/api/count")
+        .get(clickHandler.getCount);
 };
\ No newline at end of file
-- 
1.9.1

