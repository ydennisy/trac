{"changed":true,"filter":false,"title":"index.js","tooltip":"/app/routes/index.js","value":"\"use strict\";\n\nvar ClickHandler = require(process.cwd() + '/app/controllers/clickHandler.server.js');\n\nmodule.exports = function (app, db) {\n\n    var qs = require(\"querystring\");\n    var _ = require(\"underscore\");\n\n    var clickHandler = new ClickHandler(db);\n\n    app.route(\"/\")\n        .get(function(req, res){\n            res.sendFile(process.cwd() + \"/public/index.html\");\n        });\n        \n        \n\n    app.route(\"/script\")\n        .get(function(req, res){\n            res.send(\"<script type='text/javascript' src='\"+process.cwd()+\"/script/trac.js'></script>\");\n        });\n\n    app.route(\"/api\")\n        .post(function(req, res){\n\n            var str = req.url.split(\"?\")[1];\n            console.log(str);\n            var parsedQuery = qs.parse(str);\n            console.log(\"trying to parse....\"+ parsedQuery.advid);\n\n            var dataToInsert = {};\n            _.extend(dataToInsert, req.body, str);\n\n            db.collection(\"imps\").insert(dataToInsert, function (err){\n                if (err) { throw err }\n            });\n            console.log(dataToInsert);\n            res.end();\n        })\n\n        .get(function(req, res){\n            console.log(\"getting data\");\n            db.collection(\"imps\").find({}).toArray(function(err, result){\n                if (err) throw err;\n                res.send(result);\n            });\n        });\n\n    app.route(\"/api/count\")\n        .get(clickHandler.getCount);\n};","undoManager":{"mark":27,"position":37,"stack":[[{"start":{"row":30,"column":45},"end":{"row":30,"column":48},"action":"remove","lines":["str"],"id":2}],[{"start":{"row":30,"column":44},"end":{"row":30,"column":45},"action":"remove","lines":[" "],"id":3}],[{"start":{"row":30,"column":43},"end":{"row":30,"column":44},"action":"remove","lines":[","],"id":4}],[{"start":{"row":30,"column":43},"end":{"row":30,"column":44},"action":"insert","lines":[","],"id":5}],[{"start":{"row":30,"column":44},"end":{"row":30,"column":45},"action":"insert","lines":[" "],"id":6}],[{"start":{"row":30,"column":45},"end":{"row":30,"column":46},"action":"insert","lines":["s"],"id":7}],[{"start":{"row":30,"column":46},"end":{"row":30,"column":47},"action":"insert","lines":["t"],"id":8}],[{"start":{"row":30,"column":47},"end":{"row":30,"column":48},"action":"insert","lines":["r"],"id":9}],[{"start":{"row":30,"column":45},"end":{"row":30,"column":48},"action":"remove","lines":["str"],"id":10},{"start":{"row":30,"column":45},"end":{"row":30,"column":48},"action":"insert","lines":["str"]}],[{"start":{"row":30,"column":45},"end":{"row":30,"column":48},"action":"remove","lines":["str"],"id":11},{"start":{"row":30,"column":45},"end":{"row":30,"column":53},"action":"insert","lines":["req.body"]}],[{"start":{"row":32,"column":41},"end":{"row":32,"column":53},"action":"remove","lines":["dataToInsert"],"id":12},{"start":{"row":32,"column":41},"end":{"row":32,"column":42},"action":"insert","lines":["r"]}],[{"start":{"row":32,"column":42},"end":{"row":32,"column":43},"action":"insert","lines":["e"],"id":13}],[{"start":{"row":32,"column":43},"end":{"row":32,"column":44},"action":"insert","lines":["q"],"id":14}],[{"start":{"row":32,"column":44},"end":{"row":32,"column":45},"action":"insert","lines":["."],"id":15}],[{"start":{"row":32,"column":45},"end":{"row":32,"column":46},"action":"insert","lines":["b"],"id":16}],[{"start":{"row":32,"column":46},"end":{"row":32,"column":47},"action":"insert","lines":["o"],"id":17}],[{"start":{"row":32,"column":47},"end":{"row":32,"column":48},"action":"insert","lines":["d"],"id":18}],[{"start":{"row":32,"column":48},"end":{"row":32,"column":49},"action":"insert","lines":["y"],"id":19}],[{"start":{"row":32,"column":41},"end":{"row":32,"column":49},"action":"remove","lines":["req.body"],"id":21},{"start":{"row":32,"column":41},"end":{"row":32,"column":42},"action":"insert","lines":["d"]}],[{"start":{"row":32,"column":42},"end":{"row":32,"column":43},"action":"insert","lines":["a"],"id":22}],[{"start":{"row":32,"column":43},"end":{"row":32,"column":44},"action":"insert","lines":["t"],"id":23}],[{"start":{"row":32,"column":41},"end":{"row":32,"column":44},"action":"remove","lines":["dat"],"id":24},{"start":{"row":32,"column":41},"end":{"row":32,"column":53},"action":"insert","lines":["dataToInsert"]}],[{"start":{"row":30,"column":45},"end":{"row":30,"column":52},"action":"remove","lines":["req.bod"],"id":25}],[{"start":{"row":30,"column":45},"end":{"row":30,"column":46},"action":"remove","lines":["y"],"id":26}],[{"start":{"row":30,"column":45},"end":{"row":30,"column":46},"action":"insert","lines":["s"],"id":27}],[{"start":{"row":30,"column":46},"end":{"row":30,"column":47},"action":"insert","lines":["t"],"id":28}],[{"start":{"row":30,"column":47},"end":{"row":30,"column":48},"action":"insert","lines":["r"],"id":29}],[{"start":{"row":18,"column":58},"end":{"row":18,"column":90},"action":"remove","lines":["https://trac-ydennisy.c9users.io"],"id":30},{"start":{"row":18,"column":58},"end":{"row":18,"column":114},"action":"insert","lines":["http://ec2-54-76-141-248.eu-west-1.compute.amazonaws.com"]}],[{"start":{"row":14,"column":11},"end":{"row":15,"column":0},"action":"insert","lines":["",""],"id":31},{"start":{"row":15,"column":0},"end":{"row":15,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":15,"column":8},"end":{"row":16,"column":0},"action":"insert","lines":["",""],"id":32},{"start":{"row":16,"column":0},"end":{"row":16,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":16,"column":8},"end":{"row":16,"column":21},"action":"insert","lines":["process.cwd()"],"id":33}],[{"start":{"row":16,"column":21},"end":{"row":16,"column":23},"action":"insert","lines":["\"\""],"id":34}],[{"start":{"row":16,"column":8},"end":{"row":16,"column":9},"action":"insert","lines":["\""],"id":35}],[{"start":{"row":16,"column":23},"end":{"row":16,"column":24},"action":"remove","lines":["\""],"id":36}],[{"start":{"row":16,"column":8},"end":{"row":16,"column":23},"action":"remove","lines":["\"process.cwd()\""],"id":37}],[{"start":{"row":20,"column":58},"end":{"row":20,"column":114},"action":"remove","lines":["http://ec2-54-76-141-248.eu-west-1.compute.amazonaws.com"],"id":38},{"start":{"row":20,"column":58},"end":{"row":20,"column":73},"action":"insert","lines":["\"process.cwd()\""]}],[{"start":{"row":20,"column":72},"end":{"row":20,"column":73},"action":"insert","lines":["+"],"id":39}],[{"start":{"row":20,"column":59},"end":{"row":20,"column":60},"action":"insert","lines":["+"],"id":40}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":13,"column":53},"end":{"row":13,"column":53},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1449165998665}